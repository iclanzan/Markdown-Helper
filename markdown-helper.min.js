/*
Title:    Markdown Helper
URL:      http://github.com/jamiebicknell/Markdown-Helper
Author:   Jamie Bicknell
Twitter:  @jamiebicknell
*/

function MarkdownHelper(a,b){if(b.keyCode=='13'){c=false;d=a.value.replace(/\r\n/g,'\n');if(a.selectionStart){e=a.selectionStart}else{a.focus();f=document.selection.createRange();f.moveStart('character',-d.length);e=f.text.replace(/\r\n/g,'\n').length}g=d.split('\n');h=d.substr(0,e).split('\n').length;i=g[h-1].replace(/^\s+/,'');j=i.substr(0,2);if(new RegExp('^[0-9]+[\.] (.*)$').test(i)){k=i.substr(0,i.indexOf('. '));l=k+'. ';m=String(eval(k)+1)+'. ';c=true}if(i&&!c&&g[h-1].substr(0,4)=='    '){l=m='    ';c=true}if(['* ','+ ','- ','> '].indexOf(j)>=0){l=m=j;c=true}if(c){n=g[h-1].indexOf(l);if(i.replace(/^\s+/,'')==l){a.value=d.substr(0,e-1-n-m.length)+'\n\n'+d.substr(e,d.length);o=e+1-m.length-n}else{a.value=d.substr(0,e)+'\n'+(new Array(n+1).join(' '))+m+d.substr(e,d.length);o=e+1+m.length+n}if(a.selectionStart){a.setSelectionRange(o,o)}else{var f=a.createTextRange();f.move('character',o);f.select()}return false}}};